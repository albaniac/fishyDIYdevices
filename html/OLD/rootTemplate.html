<!DOCTYPE html>
<html>
<head>
<!-- <meta http-equiv='refresh' content='5'/> -->
<title>fishyDIY.local Network Devices</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel='stylesheet' href='https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css'>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js'></script>
<script type='text/javascript'>


$( document ).ready(function() {
  //var fishyJSON = 'http://www.fishydiy.com/wp-content/uploads/2018/03/device.JSON_.txt';
  var fishyJSON = 'http://10.203.1.197/device.JSON';
  //var fishyJSON = 'http://172.20.10.12/device.JSON';
  var blockCount = 0;
  var divContent="";
  var block="";
  $.getJSON(fishyJSON)
    .done(function( data ) {
	  //open the grid
	  divContent = "<div class='ui-grid-b my-breakpoint'>";
      $.each( data.fishyDevices, function( i, device ) {
		console.log( "JSON Data: " + i );
		if (device.dead == "0"){
			//add another grid element
			blockCount++;
			block = addBlock(blockCount,device);
			divContent += block;
			console.log( block );
		}  
      });
	  divContent += "</div>";
	  console.log( divContent );
    });
	$( divContent ).appendTo( "#page-content" ).enhanceWithin();
	  var content = "<div class='ui-grid-b my-breakpoint'><div class='ui-block-a'><div class='ui-body ui-body-d' ><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='false'><h3>Bent Damper 2</h3><br>10.203.1.197<hr><label for='pos-slider-0'>Set % Open:</label><input type='range' name='pos-slider-0' data-popup-enabled='true' id='slider-0' min='0' max='100' value='50'><div data-role='controlgroup' data-type='horizontal' data-mini='true'><legend>Move:</legend><button>Full Open</button><button>Full Shut</button><button>Go to % Open</button></div><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='true'><h3>Configure Device</h3><label for='name-0'>Device Unique Name:</label><input type='text' name='name-0' id='name-0' value=''><label for='group-0'>Group Name:</label><input type='text' name='group-0' id='group-0' value=''><label for='openCCWorCW-0'>Open is:</label><input type='checkbox' data-role='flipswitch' name='openCCWorCW-0' id='openCCWorCW-0' data-on-text='CCW' data-off-text='CW' data-wrapper-class='custom-label-flipswitch'><div data-role='rangeslider' data-track-theme='b'  data-mini='true' ><label for='range-3a'><p>Hard/Soft Motor Limits:<a href='#popupInfo-1' data-rel='popup' data-transition='pop' class='my-tooltip-btn ui-btn ui-alt-icon ui-nodisc-icon ui-btn-inline ui-icon-info ui-btn-icon-notext' title='Learn more'>Learn more</a></p></label><div data-role='popup' id='popupInfo-1' class='ui-content' data-theme='a' style='max-width:350px;'><p><center>UNCALIBRATED RANGE: -3500 to 3500</center><br>This shows and allows adjusting hard and soft motor position limits. Hard limits are either preset (assumed range of motion) or calibrated (tested limit switch positions). Soft limits are user defined and set the 0% to 100% range of motion.</p></div><input type='range' name='range-3a' id='range-3a' min='-3500' max='3500' value='-3500' ><input type='range' name='range-3b' id='range-3b' min='-3500' max='3500' value='3500' ></div><button class='ui-btn ui-btn-a'>Update Configuration</button><button class='ui-btn ui-btn-b'>Recalibrate</button></div></div></div></div>";
  content += "<div class='ui-block-b'><div class='ui-body ui-body-d' ><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='false'><h3>Vent Damper 1</h3><br>10.203.1.23<hr><label for='pos-slider-1'>Set % Open:</label><input type='range' name='pos-slider-1' data-popup-enabled='true' id='slider-1' min='0' max='100' value='100'><div data-role='controlgroup' data-type='horizontal' data-mini='true'><legend>Move:</legend><button>Full Open</button><button>Full Shut</button><button>Go to % Open</button></div><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='true'><h3>Configure Device</h3><label for='name-1'>Device Unique Name:</label><input type='text' name='name-1' id='name-1' value=''><label for='group-1'>Group Name:</label><input type='text' name='group-1' id='group-1' value=''><label for='openCCWorCW-1'>Open is:</label><input type='checkbox' data-role='flipswitch' name='openCCWorCW-1' id='openCCWorCW-1' data-on-text='CCW' data-off-text='CW' data-wrapper-class='custom-label-flipswitch'><div data-role='rangeslider' data-track-theme='b'  data-mini='true' ><label for='range-3a'><p>Hard/Soft Motor Limits:<a href='#popupInfo-2' data-rel='popup' data-transition='pop' class='my-tooltip-btn ui-btn ui-alt-icon ui-nodisc-icon ui-btn-inline ui-icon-info ui-btn-icon-notext' title='Learn more'>Learn more</a></p></label><div data-role='popup' id='popupInfo-2' class='ui-content' data-theme='a' style='max-width:350px;'><p><center>CALIBRATED RANGE: -3270 to 8</center><br>This shows and allows adjusting hard and soft motor position limits. Hard limits are either preset (assumed range of motion) or calibrated (tested limit switch positions). Soft limits are user defined and set the 0% to 100% range of motion.</p></div><input type='range' name='range-3a' id='range-3a' min='-3270' max='8' value='-2168' ><input type='range' name='range-3b' id='range-3b' min='-3270' max='8' value='-1013' ></div><button class='ui-btn ui-btn-a'>Update Configuration</button><button class='ui-btn ui-btn-b'>Recalibrate</button></div></div></div></div>";
  content += "<div class='ui-block-c'><div class='ui-body ui-body-d' ><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='false'><h3>Vent Damper 3</h3><br>10.203.1.145<hr><label for='pos-slider-2'>Set % Open:</label><input type='range' name='pos-slider-2' data-popup-enabled='true' id='slider-2' min='0' max='100' value='50'><div data-role='controlgroup' data-type='horizontal' data-mini='true'><legend>Move:</legend><button>Full Open</button><button>Full Shut</button><button>Go to % Open</button></div><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='true'><h3>Configure Device</h3><label for='name-2'>Device Unique Name:</label><input type='text' name='name-2' id='name-2' value=''><label for='group-2'>Group Name:</label><input type='text' name='group-2' id='group-2' value=''><label for='openCCWorCW-2'>Open is:</label><input type='checkbox' data-role='flipswitch' name='openCCWorCW-2' id='openCCWorCW-2' data-on-text='CCW' data-off-text='CW' data-wrapper-class='custom-label-flipswitch'><div data-role='rangeslider' data-track-theme='b'  data-mini='true' ><label for='range-3a'><p>Hard/Soft Motor Limits:<a href='#popupInfo-3' data-rel='popup' data-transition='pop' class='my-tooltip-btn ui-btn ui-alt-icon ui-nodisc-icon ui-btn-inline ui-icon-info ui-btn-icon-notext' title='Learn more'>Learn more</a></p></label><div data-role='popup' id='popupInfo-3' class='ui-content' data-theme='a' style='max-width:350px;'><p><center>UNCALIBRATED RANGE: -3500 to 3500</center><br>This shows and allows adjusting hard and soft motor position limits. Hard limits are either preset (assumed range of motion) or calibrated (tested limit switch positions). Soft limits are user defined and set the 0% to 100% range of motion.</p></div><input type='range' name='range-3a' id='range-3a' min='-3500' max='3500' value='-3500' ><input type='range' name='range-3b' id='range-3b' min='-3500' max='3500' value='3500' ></div><button class='ui-btn ui-btn-a'>Update Configuration</button><button class='ui-btn ui-btn-b'>Recalibrate</button></div></div></div></div></div>";

  $(content).appendTo("#page-content").enhanceWithin();

});

function addBlock(i,device){
		var masterText="";
		var mod3 = i%3;
		var blockContent="";
		if(mod3 == 1){
			blockContent += "<div class='ui-block-a'>";
		} else if(mod3 == 2) {
			blockContent += "<div class='ui-block-b'>";
		}else {
			blockContent += "<div class='ui-block-c'>";
		}
		blockContent += "<div class='ui-body ui-body-d' ><div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='false'>";
		blockContent += "<h3>" + device.deviceName + "</h3><br>" + device.IP;
		masterText;
		if(device.isMaster=="true")masterText = "(MASTER)";
		else masterText = "";
		blockContent += "<hr><label for='pos-slider-" + device.deviceID + "'>Set % Open:</label>";
		blockContent += "<input type='range' name='pos-slider-" + device.deviceID + "' data-popup-enabled='true' id='slider-" + device.deviceID + "' min='0' max='100' value='";
		var motPosPertcentValue = 100*(device.motorPos-device.motorPosAtCCW)/(device.motorPosAtCW-device.motorPosAtCCW);
		blockContent += motPosPertcentValue + "'><div data-role='controlgroup' data-type='horizontal' data-mini='true'><legend>Move:</legend><button>Full Open</button><button>Full Shut</button><button>Go to % Open</button></div>";
		blockContent += "<div data-role='collapsible' data-theme='b' data-content-theme='d' data-collapsed='true'><h3>Configure Device</h3><label for='name-" + device.deviceID + "'>Device Unique Name:</label>";
		blockContent += "<input type='text' name='name-" + device.deviceID + "' id='name-" + device.deviceID + "' value=''>";
		blockContent += "<label for='group-" + device.deviceID + "'>Group Name:</label><input type='text' name='group-" + device.deviceID + "' id='group-" + device.deviceID + "' value=''>";
		blockContent += "<label for='openCCWorCW-" + device.deviceID + "'>Open is:</label>";
		blockContent += "<input type='checkbox' data-role='flipswitch' name='openCCWorCW-" + device.deviceID + "' id='openCCWorCW-" + device.deviceID + "' data-on-text='CCW' data-off-text='CW' data-wrapper-class='custom-label-flipswitch'>";
		blockContent += "<div data-role='rangeslider' data-track-theme='b'  data-mini='true' >";
		blockContent += "<label for='range-3a'><p>Hard/Soft Motor Limits:<a href='#popupInfo-"+i+"' data-rel='popup' data-transition='pop' class='my-tooltip-btn ui-btn ui-alt-icon ui-nodisc-icon ui-btn-inline ui-icon-info ui-btn-icon-notext' title='Learn more'>Learn more</a></p></label>";
		blockContent += "<div data-role='popup' id='popupInfo-"+i+"' class='ui-content' data-theme='a' style='max-width:350px;'><p><center>";
		if(device.isCalibrated=="false") masterText = "UNCALIBRATED";
		else masterText = "CALIBRATED";
		blockContent += masterText + " RANGE: " + device.motorPosAtFullCCW + " to " + device.motorPosAtFullCW + "</center><br>This shows and allows adjusting hard and soft motor position limits. Hard limits are either preset (assumed range of motion) or calibrated (tested limit switch positions). Soft limits are user defined and set the 0% to 100% range of motion.</p></div>";
		blockContent += "<input type='range' name='range-3a' id='range-3a' min='" + device.motorPosAtFullCCW + "' max='" + device.motorPosAtFullCW + "' value='" + device.motorPosAtCCW + "' >";
		blockContent += "<input type='range' name='range-3b' id='range-3b' min='" + device.motorPosAtFullCCW + "' max='" + device.motorPosAtFullCW + "' value='" + device.motorPosAtCW + "' ></div>";
		blockContent += "<button class='ui-btn ui-btn-a'>Update Configuration</button><button class='ui-btn ui-btn-b'>Recalibrate</button></div></div></div></div>\n\n";
		//alert(blockContent);
		return blockContent;
};
</script>

<style>
/* Stack all blocks to start */
.my-breakpoint .ui-block-a,
.my-breakpoint .ui-block-b,
.my-breakpoint .ui-block-c {
    width: 100%;
    float: none;
}
@media all and (min-width: 42em) {
    .my-breakpoint .ui-block-a,
	.my-breakpoint .ui-block-b,
    .my-breakpoint .ui-block-c {
      float: left;
      width: 50%;
    }
}
/* 2nd breakpoint - Float all, 50/25/25 */
@media all and (min-width: 55em) {
    .my-breakpoint .ui-block-a,
	.my-breakpoint .ui-block-b,
    .my-breakpoint .ui-block-c {
      float: left;
      width: 33%;
    }
}
</style>  
</head>
<body>
 

<div data-role="header">
  <h2>fishyDIY Device Network</h2>
</div>
<div role="main" class="ui-content" id="page-content">
<div class='ui-grid-b my-breakpoint' id="divToPaste">
</div>
</div>
 
</body>
</html>