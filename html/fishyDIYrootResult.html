<!--------------------------------------------------------------------------------------------------------
This is the template file for the control panel site (stored in webresources.h in parts). To build it in 
the code do the following:
 1) copy the first block (from below this comment to the next comment where the JSON is defined).
 2) put it through a minifier (like https://kangax.github.io/html-minifier/) and then through a String builder
 (like http://buildmystring.com/) to create a single string with no tabs and one line.
 3) paste that into the WEBSTRPT1 F() in the webresources.h file.
 4) copy the second block (from below the JSON definition to the end).
 5) repeat these steps for the remaining blocks (skipping the JSON as direted below) 
 putting the result in WEBSTRPT2,3,4's F()
 ------------------------------------------------------------------------------------------------------ -->
 
 <!-- ----------------------------------------------------------------------------------------------------
 ----------------------------------- START OF PART 1 (STYLING): ------------------------------------------
 ------------------------------------------------------------------------------------------------------ -->
<!DOCTYPE html>
<html>
<head>
    <title>fishDIY Device Network</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js'></script>
    <style>
        :root {
            --big-fnt: 25px;
            --mid-fnt: 20px;
            --sml-fnt: 15px;
            --drk-col: #3366cc;
            --lght-col: #ffffff;
            --gry-col: #edf3ff;
            --cp-sz: 300px;
            --lab-sz: 90px;
            --val-sz: 65px;
            --sld-sz: 125px;
            --rad-sz: 25px;
            --hdr-ht: 100px;
            --smrad-sz: 7px;
            --thm-sz: 25px;
            --sld-ht: 10px;
            --sld-mar: 5px;
            --sldRow-mar: 4px;
            --sldRow-ht: 30px;
            --btnRow-mar: 2px;
            --btnRow-ht: 30px;
            --btn-ht: 28px;
            --cfg-lab: 120;
            --cfg-inp: 180;
        }

        body {
            background-color: var(--gry-col);
            font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        }

        .flex-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            background-color: var(--gry-col);
        }

        .flex-container>div {
            border-radius: var(--rad-sz);
            background-color: var(--lght-col);
            width: calc(var(--cp-sz)+10);
            margin: 5px;
            vertical-align: middle;
            text-align: center;
            line-height: calc(var(--mid-fnt) + 2);
            font-size: var(--mid-fnt);
        }
        .fishyFtr{
            border-radius: var(--rad-sz);
            font-size: var(--mid-fnt);
            font-weight: bold;
            color: white;
            background: var(--drk-col);
            height: calc(var(--mid-fnt)+10);
            align: center;
        }
        .fishyHdr,
        .hdrIcon {
            border-radius: var(--rad-sz);
            font-size: calc(var(--hdr-ht)/3);
            font-weight: bold;
            color: white;
            background: var(--drk-col);
            height: var(--hdr-ht);
            vertical-align: middle;
           }

        .CP {
            width: var(--cp-sz);
            flex: 0 1 var(--cp-sz);
        }

        .CPhd,
        .CPhd2 {
            width: var(--cp-sz);
            color: white;
            background-color: var(--drk-col);
        }

        .CPhd {
            border-radius: var(--rad-sz) var(--rad-sz) 0px 0px;
            font-size: var(--big-fnt);
        }

        .sld {
            position: absolute;
            top: var(--sld-mar);
            left: var(--lab-sz);
            -webkit-appearance: none;
            width: var(--sld-sz);
            height: var(--sld-ht);
            background: var(--gry-col);
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .sld:hover {
            opacity: 1;
        }

        .sld::-webkit-slider-thumb {
            border-radius: var(--smrad-sz);
            -webkit-appearance: none;
            width: var(--thm-sz);
            height: var(--thm-sz);
            background: var(--drk-col);
            cursor: pointer;
        }

        .sld::-moz-range-thumb {
            border-radius: var(--smrad-sz);
            width: var(--thm-sz);
            height: var(--thm-sz);
            background: var(--drk-col);
            cursor: pointer;
        }

        .sldRow {
            position: relative;
            top: var(--sldRow-mar);
            width: var(--cp-sz);
            height: var(--sldRow-ht);
        }

        .sldLab {
            position: absolute;
            top: 0px;
            left: 0px;
            width: var(--lab-sz);
            font-size: var(--mid-fnt);
        }

        .sldVal {
            position: absolute;
            top: 0px;
            left: calc(var(--cp-sz) - var(--val-sz));
            background-color: white;
            border: none;
            font-size: var(--mid-fnt);
            width: var(--val-sz);
        }

        .btnRow {
            position: relative;
            top: var(--btnRow-mar);
            width: var(--cp-sz);
            height: var(--btnRow-ht);
        }

        .lftBtn,
        .rgtBtn,
        .midBtn,
        .cfgBtn,
        .tglBtn {
            background-color: var(--drk-col);
            height: var(--btn-ht);
            border: 1px solid white;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
        }

        .lftBtn {
            border-radius: var(--smrad-sz) 0px 0px var(--smrad-sz);
            width: calc(var(--cp-sz)/4);
        }

        .rgtBtn {
            border-radius: 0px var(--smrad-sz) var(--smrad-sz) 0px;
            width: calc(var(--cp-sz)/4);
        }
        .midBtn{
            width: calc(var(--cp-sz)/2);
        }
        .cfgPnl {
            display: none;
        }

        .cfgInpLab {
            width: var(--cfg-lab);
            font-size: var(--sml-fnt);
        }

        .cfgInp {
            width: var(--cfg-inp);
            background-color: white;
            border: none;
            font-size: var(--sml-fnt);
        }

        .cfgBtn {
            border-radius: var(--smrad-sz);
            width: 48%;
            font-weight: bold;
            background-color: red;
        }

        .calTxt {
            font-size: var(--sml-fnt);
            color: var(--drk-col);
        }

        .tglBtn {
            border-radius: var(--smrad-sz) var(--smrad-sz) var(--rad-sz) var(--rad-sz);
            width: 100%;
        }

        .sw {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .sw input {
            display: none;
        }

        .swLab {
            position: relative;
            top: -10px;
        }

        .sldSw {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .sldSw:before {
            position: absolute;
            content: '';
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.sldSw {
            background-color: var(--drk-col);
        }

        input:focus+.sldSw {
            box-shadow: 0 0 1px var(--drk-col);
        }

        input:checked+.sldSw:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }
    </style>
    <script>

    /* -------------------------------------------------------------------------------------------
    --------END OF PART 1:  Do not copy the following line - this is created within the code. ----
    -------------------------------------------------------------------------------------------- */
        
        var fishyNetJSON = '{"fishyDevices":[{"deviceID":"0","IP":"10.203.1.197","dead":"0","isCalibrated":"false","isMaster":"true","motorPos":"0","motorPosAtCCW":"-3500","motorPosAtCW":"3500","motorPosAtFullCCW":"-3500","motorPosAtFullCW":"3500","deviceName":"Vent Damper 2","openIsCCW":"true","port":"8266","group":"","note":"","swVer":"20180330-1","devType":""},{"deviceID":"2","IP":"10.203.1.145","dead":"0","isCalibrated":"false","isMaster":"false","motorPos":"0","motorPosAtCCW":"-3500","motorPosAtCW":"3500","motorPosAtFullCCW":"-3500","motorPosAtFullCW":"3500","deviceName":"Vent Damper 3","openIsCCW":"true","port":"8266","group":"","note":"","swVer":"","devType":""}]}';

    /* -------------------------------------------------------------------------------------------
    --------------------------  START OF PART 2 (TRANSITION):   ----------------------------------
    -------------------------------------------------------------------------------------------- */

    </script></head><body><div class='fishyHdr'>

    <!--------------------------------------------------------------------------------------------
    ---------------------- END OF PART 2, START OF PART 3 (SVG)-----------------------------------
    -------------------------------------------------------------------------------------------- -->

    <svg class=hdrIcon height=90.6 viewBox='0 0 22.7 24'width=85.9 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><pattern id=d patternTransform='matrix(.8 0 0 .725 0 944.7)'xlink:href=#a /><pattern id=a patternTransform=scale(10) height=10 patternUnits=userSpaceOnUse width=10><circle cx=2.6 cy=.8 r=.5 /><circle cx=3 cy=2.3 r=.5 /><circle cx=4.4 cy=2.4 r=.5 /><circle cx=1.8 cy=3 r=.5 /><circle cx=6.1 cy=1.4 r=.5 /><circle cx=5.8 cy=4.4 r=.5 /><circle cx=4.3 cy=4 r=.5 /><circle cx=5.5 cy=3 r=.5 /><circle cx=4.8 cy=5.5 r=.5 /><circle cx=2.7 cy=5.2 r=.5 /><circle cx=8 cy=1.4 r=.5 /><circle cx=7 cy=5 r=.5 /><circle cx=4.3 cy=.9 r=.5 /><circle cx=7.1 cy=.3 r=.5 /><circle cx=9.6 cy=1 r=.5 /><circle cx=7 cy=2.7 r=.5 /><circle cx=8.9 cy=2.7 r=.5 /><circle cx=9.3 cy=4.4 r=.5 /><circle cx=7.8 cy=3.9 r=.5 /><circle cx=8.3 cy=5.9 r=.5 /><circle cx=8 cy=7.4 r=.5 /><circle cx=9.3 cy=8.1 r=.5 /><circle cx=8.2 cy=9.3 r=.5 /><circle cx=9.7 cy=9.5 r=.5 /><circle cx=9.7 cy=6.2 r=.5 /><circle cx=3.4 cy=6.3 r=.5 /><circle cx=2.9 cy=8.2 r=.5 /><circle cx=4.6 cy=8.7 r=.5 /><circle cx=3.2 cy=9.7 r=.5 /><circle cx=5.7 cy=7.3 r=.5 /><circle cx=6.7 cy=6.5 r=.5 /><circle cx=5.7 cy=9.7 r=.5 /><circle cx=6.5 cy=8.4 r=.5 /><circle cx=4.4 cy=7.2 r=.5 /><circle cx=.6 cy=7.3 r=.5 /><circle cx=.8 cy=5.7 r=.5 /><circle cx=1.3 cy=8.5 r=.5 /><circle cx=2 cy=6.9 r=.5 /><circle cx=.4 cy=3.2 r=.5 /><circle cx=1.2 cy=1.7 r=.5 /><circle cx=1.2 cy=.1 r=.5 /><circle cx=1.2 cy=10.1 r=.5 /><circle cx=1.3 cy=4.5 r=.5 /><circle cx=3 cy=3.8 r=.5 /></pattern><pattern id=c patternTransform='matrix(-.06187 .10055 -.35763 -.22006 2.8 947.5)'xlink:href=#b /><pattern id=b height=5.2 patternUnits=userSpaceOnUse width=30.1><path d='M7.6 0C5.1-.1 2.6.4 0 1.9V3c2.8-1.7 5.2-2 7.5-1.8 2.3.2 4.5 1 6.8 2C18.8 4.8 23.8 6.6 30 3V1.8c-6.5 3.7-10.9 2-15.4.3-2.3-.9-4.6-1.8-7.1-2z'/></pattern></defs><path d='M31.5 966.2c3.3 2 10.7 14.3 7.6 25.4-2.4 8.6-9.2 15-9.2 15 3.8 5.7 6.9 11.4 4.5 17.1l7.6 1.3c12-1.7 22.4-4.6 30.4-9.3 4.5-2.7 7.2-6 7.7-10.7.5-2.3-2-3.5-3.1-4.9l-9.3-6.7c-6-9.2-12.2-13.5-18.3-19.7-5.8-5.2-11.8-6.1-17.9-7.5z'stroke=#00f fill=url(#c) stroke-width=.4 transform='matrix(.15858 -.16304 .15876 .16286 -156.3 -141.8)'fill-rule=evenodd /><path d='M7.3 982.2c2.3-3.5 3.1-5 5.8-8.2a31.2 31.2 0 0 1 18.7-7.6c6.1-5 9.7-9.8 27.7-9.8a38.4 38.4 0 0 0 3 20.7c3 5.3 9.2 7.7 12 13.6-2.1.6-4.5 1.4-5.6 3 4.7 5.1 5.5 3.2 7.3 3.3 2.1-.6 3.5-3.8 4.6-5.6 3.8-6.8 6.8-9.4 11.4-11.4 3.5-1.5 9.2-2.5 13-1.2 0 0-10.1 11-9 23.6 1 10.8 6.8 17 8.3 18.9-4.5 2-12.6 1-17.8-.9-2.9-1-8.2-4.7-10.7-7.6-1.4 1.1-1.2 1.3-4.6 3 1.3.7 3.1 1.9 3.4 2.8 1.7 2.8-14.9 12.1-20.6 14.4-2.5 1-5.8-1-6.6-2.2-1.3-1.9-3-3.6-5-5.7-3.4-.3-4.3.2-7.7-1.3a19 19 0 0 1-4.8 8.3c-3.5-2.4-5.7-3.6-8-6.4-1.4 3.3-5.4 4-7.5 4.1-2.7-5.8-5.3-13.8-.6-19.2-4.4-5.4-7.3-8.6-8.7-15-1-.4-3.6-.2-3.8-3.4.6-2 1.2-2.4 3-4-.9-1-1.2-1-.7-2.7 1.1-2.3 2.2-1.5 3.5-3.5z'stroke=red fill=#fff stroke-width=.4 transform='matrix(.15858 -.16304 .15876 .16286 -156.3 -141.8)'fill-rule=evenodd /><g fill=url(#d) fill-rule=evenodd stroke-width=.4 transform='matrix(.15858 -.16304 .15876 .16286 -156.3 -141.8)'><path d='M73.4 997.2l4.7-.6s6.1-12.2 11.7-15.5c4.5-2.7 15.8-2.5 15.8-2.5s-9.5 10.8-10 21.8c-.4 12 9.2 21 9.2 21s-8.8 1.1-13 .3a36 36 0 0 1-15.8-8.5s4.8-3.6 4.6-8.3c-.1-5-7.2-7.7-7.2-7.7z'stroke=#f0f /><path d='M42.9 1025.6l5.5 7c2 1.6 4 2 6.4.5a56 56 0 0 0 19.8-13c1.1-.9.3-1.4-.2-2l-3.3-2a49 49 0 0 1-11.7 5.3zM32.8 966s6.4-5.8 10.3-7.4c5.2-2 16.6-2.1 16.6-2.1s-1.6 13.4 1.7 19.6c2.8 5.4 14.6 14 13.1 14.5-4.1.7-4.6 2.2-5.9 3.5 0 0-8-9.6-12.2-14.4A55.6 55.6 0 0 0 32.8 966z'stroke=#0f0 /><path d='M14.1 1010.4s-3.1 5.3-3.1 8.7c0 3.7 3.4 11.3 3.4 11.3s7.2-1 7.3-4.4c-1.5-4.1-2.4-12-2.4-12-1.7-.9-3.5-1.2-5.2-3.6z'stroke=#0ff /><path d='M19.3 1013.6s.8 8.9 3 12.5c1.9 2.9 7.8 6.6 7.8 6.6.8.2 6-8.8 5-14.2-.7-4-5.2-11.8-5.2-11.8-3.6 3-7.3 6.8-10.6 7z'stroke=#f60 /></g><path d='M14.7 4c-.3.4-.2.8-.1 1.2 0 .4.2.8 0 1.3 0 .4.2.9.4 1.2l.3.5v.3c.6 0 .4-.2.2-.4 0-.2-.3-.3-.4-.5a2 2 0 0 1-.3-1.1V5.2c-.2-.5-.2-.7-.1-1.2zM16 5.7c-.2 0 0 .5 0 .8v1c-.2.2-.1.3-.1.5l-.3.5.3.2c.2-.3.1-.5.1-.7v-.5c.2-.4.2-.7.1-1l-.1-.8zm.3 2.7l-.3.3.2.2.2-.4c0-.2.2-.2.5-.4s.8-.3 1-.9c-.4.6-.7.7-1.1.9-.2 0-.4.1-.5.3zm0 .6v.2L17 9l.7-.2c.3-.2 1 0 1.1-.3-.2.2-.7 0-1.1.1-.3 0-.5.2-.8.3l-.7.2zm.1.4v.2h1.3l1-.1h-1l-.6-.1h-.7zm-8.2 8.4v.4c.6 0 1.1.2 1.7.5.5.2 1 .9 1.2 1.3l.4 1c-.2-.7-.4-1.4-.8-1.9-.4-.4-.9-.8-1.4-1l-1-.3zm0 1L8 19c.5 0 .9 0 1.2.2l.7.7.4.3-.5-.6c-.2-.2-.3-.5-.6-.6l-1.1-.4zm-.3.7l1 1c.5.2.5.3 1 .3.3 0 .7 0 .9-.2-.6 0-1.2 0-1.7-.2l-1-1.1-.2.2zm-1.1 1.1a8.2 8.2 0 0 0 .6 1c.3.4.7.6 1 .7l.6.3.2.3c.1-.2 0-.4-.2-.5a2 2 0 0 0-.4-.2l-1-.7-.3-.6.1-.5zM4.2 6.4c-.3.4-.6.9-.6 1.2l-.2 1v.8l.5-.1-.2-.6v-1l.6-1.1.6-.7-.7.5zm1 .6a2 2 0 0 0-.4.7c0 .2-.1.5 0 .8v.4H5V7.8c0-.2 0-.5.3-.7l.4-.7-.6.6zm1.2.8l-.2.5v.3h.4v-.8l.3-.7c-.3.2-.5.5-.5.7zm1.3.6l-.1.2H8v-.9c-.2.2-.2.4-.3.7zM9 8.2v.3h.3l-.1-.2.1-.4c-.2 0-.2 0-.3.3zm1.2 0v.4h.2v-.3l.1-.4c-.2 0-.3.2-.3.4zm1.1 0v.4h.4s-.2-.1-.2-.3l.3-.5c-.3.1-.4.3-.5.5zM16 13l-.1.4h.6l.6-.6-.7.4c-.1 0-.3 0-.5-.2zm-.5 1.3v.3h.5c.2 0 .4 0 .7-.3l-.7.2c-.2 0-.3 0-.5-.2zm-.6 1.4l-.1.2.7.2c.3 0 .6-.1.8-.3l-.8.1-.6-.2zm-1 1.5v.3l.8.1c.4 0 .7 0 1-.2h-1l-.8-.2z'fill-rule=evenodd color=#000 overflow=visible style=line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;isolation:auto;mix-blend-mode:normal font-family=sans-serif font-weight=400 white-space=normal /><path d='M22.9 988s.2-4.4 1.5-5.6c1.3-1.4 3.3-1.4 5.1-.7 1.9.8 3.2 2.8 3.6 4.8.3 1.3-.5 3.1-1.5 4.1-1 1-3.7 1-3.7 1s-1.1-2-2-2.7c-.9-.6-3-1-3-1z'stroke=red fill=none stroke-width=.4 transform='matrix(.15858 -.16304 .15876 .16286 -156.3 -141.8)'/><path d='M13.8 1010.5c-3.3-4.5-7.3-8.4-8.4-14.8-1.2.6-2.4-.2-3.7-1.6-1-2.8.8-4 2.3-5.6-.8-3-.3-5.1 2.5-6 0 0 5.6-9 9.9-11.9a50 50 0 0 1 15.6-4.4 35 35 0 0 1 8 21.2c-.4 7.6-5 13.6-10 19.3-2.9 3.3-10.9 7.2-10.9 7.2-1.8 0-3.6-1.5-5.4-3.4z'stroke=#f0f fill=none stroke-width=.4 transform='matrix(.15858 -.16304 .15876 .16286 -156.3 -141.8)'/><path d='M5.3 8.9v.2c.2 0 .7.1 1 .4l.2.4v.4l-.4.3-1 .6.1.2c.7-.4 1-.6 1.9-.8.4-.2 1 0 1.3.3l.2.3v.4l-.7.7-1 .4.1.2a7 7 0 0 1 1.4-.5c.4-.1 1 0 1.3.3l.2.3v.4c-.2.4-.7.7-1.5 1l-.6.2.1.3a6.3 6.3 0 0 1 1.2-.5c.4 0 1 0 1.3.4l.2.3v.4c-.2.3-.7.6-1.4 1l-1 .5v.2l1.6-.7c.4 0 1 0 1.3.4l.2.3v.4l-.7.5.2.3.7-.7v-.8l.5-.1c.3 0 .6 0 .8.2l.3.4v.5h.2v-.6l-.4-.5c-.2-.2-.5-.3-.9-.3l.6-.5c.4-.2.7-.4 1.2-.1l.4.4.2-.1a1.1 1.1 0 0 0-1-.7l.3-.5v-.5c.4-.3.8-.5 1.3-.3l.3.3.2-.2a1 1 0 0 0-.4-.3l-.7-.1c.2-.2.3-.4.3-.8v-.4c.3-.4.6-.7 1.1-.6.1 0 .2 0 .3.2l.2-.2a1 1 0 0 0-.4-.2h-.6l.2-.8-.2-.5.4-.4c.2-.2.4-.4.7-.4v-.3l-.4.2v-.5a1 1 0 0 0-.3-.6 1 1 0 0 0-.4-.3v.3s.2 0 .3.2l.1.4v.7l-.6.5a1 1 0 0 0-.3-.2h-.5l.2-.4a1 1 0 0 0 0-.7l-.2-.5-.2.2.2.4v.5c0 .3-.2.4-.4.5l-.5.2a1 1 0 0 0-.7-.3l.1-.2c.2-.2.2-.4.2-.6l-.1-.5h-.2v.9a1 1 0 0 1-.5.4l-.5.1c-.3-.3-.6-.5-.9-.5l.3-.4c.2-.2.2-.4.2-.6h-.2c0 .2 0 .3-.2.5a1 1 0 0 1-.5.4l-1 .2v-.2a2 2 0 0 0-1.3-1V9c.3 0 .8.3 1 .8l.2.3c0 .2 0 .3-.2.4l-.6.3c-.4-.4-1-.5-1.5-.4l-.4.1c.2-.2.2-.4.1-.6l-.2-.4c-.4-.4-.8-.5-1.2-.5zM9.5 10l.8-.1c.5 0 .9 0 1.2.4l.1.4v.5c-.3.3-.5.4-.9.5l-.1-.5c-.4-.5-1-.6-1.4-.6.2-.1.3-.4.3-.6zm-.8 1l.4-.1c.5 0 1 0 1.3.4v.9a1 1 0 0 1-.5.4c-.4-.4-1-.6-1.4-.5l.2-.4c.2-.2.2-.4.1-.6V11zm3-.6h.6c.4-.1.8 0 1 .3.2.1.2.3.3.4l-.1.5a1 1 0 0 1-.4.5h-.3c-.3-.4-.9-.5-1.3-.5l.2-.3c.2-.2.2-.4.2-.6l-.1-.3zm-1 1.6l.8-.1c.4 0 .8 0 1.1.4l.2.4-.1.5-.5.4-.4.1-.1-.6c-.4-.5-.8-.6-1.3-.5l.2-.2.1-.4zm-.6.8h.2c.5 0 .9 0 1.2.4l.1.4v.5l-.7.5h-.2c-.3-.3-.8-.5-1.2-.5.2-.1.5-.3.6-.6v-.7zm3.5-2.1c.4-.3.7-.4 1.1-.2.1 0 .3 0 .4.2l.1.4c0 .4 0 .6-.2.8l-.5.5a1 1 0 0 0-.3-.3c-.2-.1-.5-.2-.7-.1l.2-.3a1 1 0 0 0 0-.6v-.4zm-.6 1.7l.2-.1c.3-.1.5-.2.9 0l.3.3v.5c0 .3 0 .5-.2.7l-.6.4a1 1 0 0 0-.2-.3c-.3-.2-.5-.3-.8-.3l.3-.3.1-.6v-.3zm-2.2 2.5l.8-.1c.2 0 .4 0 .6.4l.1.3v.5l-.7.6h-.3c-.4-.2-.8-.4-1.1-.4.2-.2.5-.3.6-.6V15zm1-1h.3c.4-.1.7-.1 1.1.2l.2.4c.1.1.1.3 0 .4 0 .3-.2.5-.3.6l-.6.3V15l-.9-.5h-.1l.2-.3.1-.2z'fill-rule=evenodd color=#000 overflow=visible style=line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;isolation:auto;mix-blend-mode:normal font-family=sans-serif font-weight=400 white-space=normal /><path d='M4.7 4.2a9.6 9.6 0 0 0-2.4 3.5C2 8.7 2 9.4 2 10.2c-.5.4-1 1.1-1.3 2a5 5 0 0 0-.7 2.6c0 1 .2 1.3.4 2.3v1.1c.2.3.4.5.6.5v.2c0 .3 0 .6.2.8.2.3.6.5 1 .4l.2-.2c1.2.7 2.2.7 3.6.8.1.8.5 1.6 1.1 2 .7.6 1.4 1 2.1 1.2h.4l.5-1c.2-.2.2-.6.2-.9.6 0 1.2 0 2-.2h.2v-.4a6 6 0 0 0-.6-2.2 4 4 0 0 0 1.3-.7l1.5.2.9-.1c.3-.2.7-.4.8-.8a20.5 20.5 0 0 0 1.2-5v-.6c-.1-.2-.2-.4-.5-.5l-.6.1.2-.7a7 7 0 0 0 2.7-.5c1.2-.6 2.6-1.6 3-2.9l.2-.4h-.4c-.5 0-2.3-.2-4-1.7-2-1.8-2.3-5-2.3-5V0l-.4.2c-1 .5-1.7 1.6-2 2.5-.5 1.1-.5 2.2 0 4l.2.8c.1.2.2.4.1.5l-.3.3c0 .1-.6.3-1 .3l.3-1 .2-.3c-.8-.3-1.6-.2-2.4-.2a6 6 0 0 1-2 0 8.2 8.2 0 0 1-3.5-2.8L5 4zm.2.5a9.5 9.5 0 0 0 3.7 2.8c.7.2 1.5.1 2.2 0 .5 0 1 0 1.6.2l-.2.2v.7l-2-.2c-2 0-4.3-.1-6.2.7l-1.6.8c0-.8.1-1.3.3-2 .3-.8 1-2 2.2-3.2zm-2.7 6c.7-.1 1.6.2 2.1.4a6 6 0 0 1 3 2.5 9.3 9.3 0 0 1 .4 6.4l-.5.2h-.9c-1.5-.1-2.4-.2-3.6-1h-.3l-.3.2s-.3.2-.4 0l-.2-.3c0-.1-.1-.2 0-.4h.4c.3.1.6.1.8 0a3 3 0 0 0 1.2-.6c.5-.4.7-1 .5-1.5 0 0-.3.8-.7 1l-1.1.7H2l-.5-.1H1v-1.3l-.4-2.2c0-.5.2-1.6.5-2.4l1.1-1.7zm.5-.4c.3-.3 1-.6 1.5-.8C6 8.8 8 9 10.1 9l2.2.2 1.1-.2 1.5-.3.7.1c.2 0 .3.2.4.4.2.4.3 1 .3 1.4L16 12l-1.2 2.9a17 17 0 0 1-1.9 3.1c-.5.6-.6.6-1.3 1-.7-1-1.8-1.6-3.3-1.8 0-1.2-.2-2.5-.8-3.7-.7-1.3-2-2.1-3.1-2.6-.6-.3-1.3-.4-1.8-.5zm.3 2.3l-.4.6c-.1.2-.2.5.1.6.3 0 .3 0 .4-.2l.3-.7.3-.3.3-.1c.9 0 .8 0 1.1-.4H3.3l-.3.5zM15.6.9c.1 1 .5 3.7 2.2 5.2 1.6 1.3 3.5 1.5 4.4 1.6-.5.8-2 2-2.9 2.5a7 7 0 0 1-2.5.2l-.2-.5c0-.4-.1-.6-.3-.9l-.6-.6-.8-.1h-.7c.2-.1.3-.3.3-.4v-.6l-.4-.8c-.4-1.7-.6-2.5-.2-3.6.4-.7 1-1.7 1.7-2zM3.5 13.6c-.2.3-.2.6-.1 1 0 .4.3.6.5.9-.2.2-.3.3-.3.7.3 0 .5-.4.6-.6.2-.1.3-.3.5-.3l1 .1.8-.1s-.5 0-.7-.2c.2-.3.4-.7.3-1 0-.3-.4-.6-.7-.8a2 2 0 0 0-1-.3c-.5.1-.7.3-1 .6zm1-.2c.2 0 .5 0 .7.2.3.2.5.4.5.7 0 .3 0 .4-.2.6h-.7l-.6.3-.5-.7a.8.8 0 0 1 .1-.7l.6-.4zm4 4.1c1.2.3 2.3 1 3 2 .2.4.5 1 .6 1.8-.7.2-1.4.2-2 0-.9 0-1.7-.7-2.1-1.2l.1-.5a10.2 10.2 0 0 0 .3-2zm-1.9 3.2h.6l.5-.3c.7.7 1.4 1.3 2 1.5.2.3.2.6 0 .9l-.3.6a8 8 0 0 1-1.8-1.1c-.5-.5-.9-1-1-1.6zm9.8-8.2l.2-.4h.6l.1.6c0 .4 0 1-.2 1.7a16 16 0 0 1-1 3.2l-.6.5h-1.9c.7-1 1.3-2.2 1.8-3.2l1-2.4z'fill-rule=evenodd color=#000 overflow=visible style=line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;isolation:auto;mix-blend-mode:normal font-family=sans-serif font-weight=400 white-space=normal /><path d='M5.1 13.8c.2.2.3.5.1.8-.2.2-.5.3-.8.2a.6.6 0 0 1-.3-.7c0-.3.3-.5.6-.5.3.2.1.4 0 .6.4 0 .4-.2.4-.4z'fill-rule=evenodd color=#000 overflow=visible style=marker:none /></svg>
    <span >fishyControls</span>
    </div>   
    
   <!----------------------------------------------------------------------------------------------
    ------------------------END OF PART 3, START OF PART 4 (SCRIPTS)--------------------------------
    --------------------------------------------------------------------------------------------- -->

    <script>
        function toggleCfg(num) {
            var btn = $('#cfgBtn-' + num)[0];
            var pnl = $('#cfgPnl-' + num)[0];
            if (pnl.style.display == 'block') {
                pnl.style.display = 'none';
                btn.value = '[+] Show Settings Panel';
            } else {
                pnl.style.display = 'block';
                btn.value = '[-] Hide Settings Panel';
            }
        }
        function sync(num, name, what) {
            var sliderID = '#' + name + 'Sld-' + num;
            var valID = '#' + name + 'Val-' + num;
            var slider = $(sliderID)[0];
            var val = $(valID)[0];
            if(name=='pctOpen'){
                var btn = $('#pobtn-' + num)[0];
            }
            if (what == 1) {
                val.value = slider.value;
                if(name=='pctOpen'){btn.value='Go ' + slider.value + '% Open';}
            } else {
                slider.value = val.value;
                if(name=='pctOpen'){btn.value='Go ' + val.value + '% Open';}
            }
        }
        function refreshToggle(){
            var label = $('#swRefreshLab-1')[0];
            var sw = $('#swRefreshChck-1')[0];
            if (sw.checked == true) { 
                label.innerHTML = 'Auto-refresh On';
                pollTimer = setTimeout(function () {
                    pollJSON();
                }, 10000);
            } else { 
                label.innerHTML = 'Auto-refresh Off'; 
                clearTimeout(pollTimer);
            }
        }
        function openIsCCWUpd(num) {
            var label = $('#swLab-' + num)[0];
            var sw = $('#swChck-' + num)[0];
            if (sw.checked == true) { label.innerHTML = 'Open is CCW'; } else { label.innerHTML = 'Open is CW'; }
        }
        function swMstrUpd(num) {
            var label = $('#swMstrLab-' + num)[0];
            var sw = $('#swMstrChck-' + num)[0];
            if (sw.checked == true) { label.innerHTML = 'Master Node'; } else { label.innerHTML = 'Slave Node'; }
        }
        function sendCmd(num, command) {
            var remIP = $('#targetIP-' + num)[0].value;
            var cmd = '';
            if (command == 'O') {
                cmd = 'open';
            } else if (command == 'C') {
                cmd = 'close';
            } else if (command == 'cal') {
                cmd = 'calibrate';
            } else if (command == 'rstWifi') {
                cmd = 'reset_wifi';
            } else if (command == 'G') {
                var pos;
                cmd = 'goto';
                pos = $('#pctOpenVal-' + num)[0].value;
                while (pos.length < 3) pos = '0' + pos;
                cmd += pos;
            } else if (command == 'config') {
                var isMstr = 'false';
                var ccwIsOpen = 'false';
                if ($('#swMstrChck-' + num)[0].checked) isMstr = 'true';
                if ($('#swChck-' + num)[0].checked) ccwIsOpen = 'true';
                cmd = 'config';
                cmd += ';ccwLim=' + $('#ccwLimVal-' + num)[0].value;
                cmd += ';cwLim=' + $('#cwLimVal-' + num)[0].value;
                cmd += ';openIsCCW=' + ccwIsOpen;
                cmd += ';isMaster=' + isMstr;
                cmd += ';devName=' + encodeURIComponent($('#devName-' + num)[0].value);
                cmd += ';groupName=' + encodeURIComponent($('#groupName-' + num)[0].value);
                cmd += ';devType=' + encodeURIComponent($('#devType-' + num)[0].value);
                cmd += ';note=' + encodeURIComponent($('#note-' + num)[0].value);
            }
            var query = '/genericArgs?IPCommand=' + remIP + ';' + cmd;
            var jqxhr = $.get(query, function () {
                alert('Success.');
            });
        }
        function pollJSON() {
            $.getJSON('./device.JSON', function (data) {
                var DA = data.fishyDevices;
                var addDiv = '';
                var mstrTxt = '';
                var calTxt = '';
                var chckTxt = '';
                var ii;
                $.each(DA, function (num, d) {
                    if (d.dead == '0') {
                        ii = d.deviceID;
                        //look for new devices in the JSON
                        if($('#pctOpenVal-' + ii)[0]==null){
                            $(addDevice(d)).appendTo('.flex-container');
                        }else{
                            if (d.isMaster == 'true') { mstrTxt = 'MASTER '; } else { mstrTxt = ''; }
                            if (d.isCalibrated == 'false') { calTxt = 'LIMITS ARE UNCALIBRATED<br>'; } else { calTxt = ''; }
                            if (d.openIsCCW == 'true') { chckTxt = 'checked'; } else { chckTxt = ''; }
                            $('#hd1-'+ii)[0].innerHTML = d.deviceName;
                            $('#hd2-'+ii)[0].innerHTML = '(' + mstrTxt + d.IP + ')';
                            $('#note-'+ii)[0].value = d.note;
                            $('#devName-'+ii)[0].value = d.deviceName;
                            $('#groupName-'+ii)[0].value = d.group;
                            $('#devType-'+ii)[0].value = d.devType;
                            $('#pctOpenVal-' + ii)[0].value = posPct(d.motorPos, d.motorPosAtCCW, d.motorPosAtCW,d.openIsCCW);
                            $('#pctOpenSld-' + ii)[0].value = posPct(d.motorPos, d.motorPosAtCCW, d.motorPosAtCW,d.openIsCCW);
                            $('#ccwLimVal-' + ii)[0].value = d.motorPosAtCCW;
                            $('#ccwLimVal-' + ii)[0].min = d.motorPosAtFullCCW;
                            $('#ccwLimVal-' + ii)[0].max = d.motorPosAtFullCW;
                            $('#ccwLimSld-' + ii)[0].value = d.motorPosAtCCW;
                            $('#ccwLimSld-' + ii)[0].min = d.motorPosAtFullCCW;
                            $('#ccwLimSld-' + ii)[0].max = d.motorPosAtFullCW;
                            $('#cwLimVal-' + ii)[0].value = d.motorPosAtCW;
                            $('#cwLimVal-' + ii)[0].min = d.motorPosAtFullCCW;
                            $('#cwLimVal-' + ii)[0].max = d.motorPosAtFullCW;
                            $('#cwLimSld-' + ii)[0].value = d.motorPosAtCW;
                            $('#cwLimSld-' + ii)[0].min = d.motorPosAtFullCCW;
                            $('#cwLimSld-' + ii)[0].max = d.motorPosAtFullCW;
                            $('#calTxt-' + ii)[0].innerHTML = calTxt;
                        }
                    }
                });
                //look for CP items that aren't in the JSON anylonger
                var gone;
                $('.CP').each(function(i,e){
                    gone = true;
                    $.each(DA, function (num, d) {
                        if(d.deviceID == e.id) gone=false;
                    });
                    if(gone){
                        //TODO delete the CP
                    }
                });
                pollTimer = setTimeout(function () {
                    pollJSON();
                }, 10000);
            });
        }
        function posPct(motPos, motPosCCW, motPosCW,openIsCCW) {
            if(motPosCW-motPosCCW==0) return 0;
            var ret = Math.round(100 * ((motPos - motPosCCW) / (motPosCW - motPosCCW)));
            //correct if CW = open
            if(openIsCCW=='true') ret = 100-ret;
            return ret;
        }
        function addDevice(d){
            if (d.isMaster == 'true') { mstrTxt = 'MASTER '; mstrChckTxt = 'checked'; } else { mstrTxt = ''; mstrChckTxt = ''; }
            if (d.isCalibrated == 'false') { calTxt = 'LIMITS ARE UNCALIBRATED<br>'; } else { calTxt = ''; }
            if (d.openIsCCW == 'true') { chckTxt = 'checked'; } else { chckTxt = ''; }
            if (d.dead == '0') {
                var ii = d.deviceID;
                var addDiv = "<div class='CP' id='" + ii +"'>" +
                    "<input type='hidden' id='targetIP-" + ii + "' value='" + d.IP + "'>" +
                    "<div class='CPhd' id='hd1-" + ii + "'>" + d.deviceName + "</div>" +
                    "<div class='CPhd2' id='hd2-" + ii + "'>(" + mstrTxt + d.IP + ")</div>" +
                    "<div class='sldRow'>" +
                    "	<div class='sldLab'>% Open</div><input class='sld' id='pctOpenSld-" + ii + "' type='range' value='" + posPct(d.motorPos, d.motorPosAtCCW, d.motorPosAtCW,d.openIsCCW) + "' max='100' min='0' oninput=sync(" + ii + ",'pctOpen',1)> <input class='sldVal' id='pctOpenVal-" + ii + "' type='number' value='" + posPct(d.motorPos, d.motorPosAtCCW, d.motorPosAtCW,d.openIsCCW) + "' max='100' min='0' onchange=sync(" + ii + ",'pctOpen',2)>" +
                    "</div>" +
                    "<div class='btnRow'><input class='lftBtn' id='fobtn-" + ii + "' type='button' value='Full Open' onclick=sendCmd(" + ii + ",'O')><input class='midBtn' id='pobtn-" + ii + "' type='button' value='Go % Open' onclick=sendCmd(" + ii + ",'G')><input class='rgtBtn' id='fcbtn-" + ii + "' type='button' value='Full Close' onclick=sendCmd(" + ii + ",'C')></div>" +
                    "<div class='cfgPnl' id='cfgPnl-" + ii + "' style='display: hidden;'><hr>" +
                    "<label class='cfgInpLab' for='devNote-" + ii + "'>Note:<input class='cfgInp' id='note-" + ii + "' value='" + d.note + "' maxlength='55'></label><div class='calTxt' id='calTxt-" + ii + "'>" + calTxt + "</div>" +
                    "	<div class='sldRow'>" +
                    "		<div class='sldLab'>CCW Lim</div><input class='sld' id='ccwLimSld-" + ii + "' type='range' value='" + d.motorPosAtCCW + "' max='" + d.motorPosAtFullCW + "' min='" + d.motorPosAtFullCCW + "' oninput=sync(" + ii + ",'ccwLim',1)> <input class='sldVal' id='ccwLimVal-" + ii + "' type='number' value='" + d.motorPosAtCCW + "' max='" + d.motorPosAtFullCW + "' min='" + d.motorPosAtFullCCW + "' onchange=sync(" + ii + ",'ccwLim',2)>" +
                    "	</div>" +
                    "	<div class='sldRow'>" +
                    "		<div class='sldLab'>CW Lim</div><input class='sld' id='cwLimSld-" + ii + "' type='range' value='" + d.motorPosAtCW + "' max='" + d.motorPosAtFullCW + "' min='+d.motorPosAtCCW+' oninput=sync(" + ii + ",'cwLim',1)> <input class='sldVal' id='cwLimVal-" + ii + "' type='number' value='" + d.motorPosAtCW + "' max='" + d.motorPosAtFullCW + "' min='" + d.motorPosAtFullCCW + "' onchange=sync(" + ii + ",'cwLim',2)>" +
                    "	</div>" +
                    "	<div class='swRow'>" +
                    "		<label class='sw' id='sw-" + ii + "'><input type='checkbox' id='swChck-" + ii + "' " + chckTxt + " onchange=openIsCCWUpd(" + ii + ")><span class='sldSw'></span></label><span class='swLab' id='swLab-" + ii + "'>Open is CCW</span>" +
                    "	</div>" +
                    "	<div class='swRow'>" +
                    "		<label class='sw' id='swMstr-" + ii + "'><input type='checkbox' id='swMstrChck-" + ii + "' " + mstrChckTxt + " onchange=swMstrUpd(" + ii + ")><span class='sldSw'></span></label><span class='swLab' id='swMstrLab-" + ii + "'>Master Node</span>" +
                    "	</div>" +
                    "	<label class='cfgInpLab' for='devName-" + ii + "'>Device Name:<input class='cfgInp' id='devName-" + ii + "' value='" + d.deviceName + "' maxlength='40'></label>" +
                    "	<label class='cfgInpLab' for='devGroup-" + ii + "'>Group Name:<input class='cfgInp' id='groupName-" + ii + "' value='" + d.group + "' maxlength='40'></label>" +
                    "	<label class='cfgInpLab' for='devType-" + ii + "'>Device Type:<input class='cfgInp' id='devType-" + ii + "' value='" + d.devType + "' maxlength='20'></label>" +
                    "	<label class='cfgInpLab' >SW Version:<span class='cfgInp' id='devSWver-" + ii + "'>" + d.swVer + "</span></label>" +
                    "	<div class='btnRow'>" +
                    "	<input class='cfgBtn' id='updCfgBtn-" + ii + "' type='button' value='UPDATE SETTINGS' onclick=sendCmd(" + ii + ",'config')>"+
                    "	</div><div class='btnRow'>" +
                    "<input class='cfgBtn' id='updCfgBtn-" + ii + "' type='button' value='AUTO-CAL.' onclick=sendCmd(" + ii + ",'cal')>" +

                    "	<input class='cfgBtn' id='rstWifiBtn-" + ii + "' type='button' value='RESET WIFI' onclick=sendCmd(" + ii + ",'rstWifi')>" +
                    "	</div>" +
                    "	<hr>" +
                    "</div>" +
                    "<div class='btnRow'><input class='tglBtn' id='cfgBtn-" + ii + "' type='button' value='[+] Show Settings Panel' onclick=toggleCfg(" + ii + ")></div>" +
                    "</div>";
                return addDiv;
            }
        }
        var pollTimer;
        function buildPage() {
            var data = JSON.parse(fishyNetJSON);
            var DA = data.fishyDevices;
            var items = [];
            var addDiv = '';
            var mstrTxt = '';
            var calTxt = '';
            var chckTxt = '';
            var mstrChckTxt = '';
            var ii;
            $.each(DA, function (i, d) {
                items.push(addDevice(d));
            });
            $('<div/>', {
                'class': 'flex-container',
                html: items.join('')
            }).appendTo('body');
            pollTimer = setTimeout(function () {
                pollJSON();
            }, 10000);
        }
        window.onload = buildPage();
        $('.cfgInp').keyup(function(e){     
            var str = $.trim( $(this).val() );
            if( str != "" ) {
                var regx = /^[A-Za-z0-9_ .,-]+$/;
                if (!regx.test(str)) {
                    alert('Only letters, numbers, underscore, space, comma, period, and dash are allowed.');
                    $(this).val($(this).val().replace(/[^A-Za-z0-9_ .,-]/g, ''));
                }
            }
        });
    </script>

    <!-- -------------------------------------------------------------------------------------------
    -------------------------------------- END OF PART 4, START OF PART 5 (END)---------------------
    -------------------------------------------------------------------------------------------- -->

    <div class='fishyFtr'><div class='swRow'><label class='sw' id='swRefresh-1'><input type='checkbox' id='swRefreshChck-1' checked onchange=refreshToggle()><span class='sldSw'></span></label><span class='swLab' id='swRefreshLab-1'>AutoRefresh On</span></div></div>
</body>
</html>
    <!-- -------------------------------------------------------------------------------------------
    -------------------------------------- END OF PART 5 -------------------------------------------
    -------------------------------------------------------------------------------------------- -->